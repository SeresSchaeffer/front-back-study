"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.transformFiles = exports.reduceChunk = exports.reduceAssets = exports.generateManifest = void 0;
const path_1 = require("path");
const generateManifest = (compilation, files, { generate, seed = {} }) => {
    let result;
    if (generate) {
        const entrypointsArray = Array.from(compilation.entrypoints.entries());
        const entrypoints = entrypointsArray.reduce((e, [name, entrypoint]) => Object.assign(e, { [name]: entrypoint.getFiles() }), {});
        result = generate(seed, files, entrypoints);
    }
    else {
        result = files.reduce((manifest, file) => Object.assign(manifest, { [file.name]: file.path }), seed);
    }
    return result;
};
exports.generateManifest = generateManifest;
const getFileType = (fileName, { transformExtensions }) => {
    const replaced = fileName.replace(/\?.*/, '');
    const split = replaced.split('.');
    const extension = split.pop();
    return transformExtensions.test(extension) ? `${split.pop()}.${extension}` : extension;
};
const reduceAssets = (files, asset, moduleAssets) => {
    let name;
    if (moduleAssets[asset.name]) {
        name = moduleAssets[asset.name];
    }
    else if (asset.info.sourceFilename) {
        name = path_1.join(path_1.dirname(asset.name), path_1.basename(asset.info.sourceFilename));
    }
    if (name) {
        return files.concat({
            isAsset: true,
            isChunk: false,
            isInitial: false,
            isModuleAsset: true,
            name,
            path: asset.name
        });
    }
    const isEntryAsset = asset.chunks && asset.chunks.length > 0;
    if (isEntryAsset) {
        return files;
    }
    r